# CHECK 4: Price Discrimination (Article 8.3)
# Find SMEs paying significantly more than comparable SMEs
# Expected: 2 rows showing 33% and 37% price differences

PREFIX dataact: <http://www.semanticweb.org/dataact#>
PREFIX dpv: <https://w3c.github.io/dpv/2.2/dpv/#>

SELECT ?recipient1 ?price1 ?recipient2 ?price2 
       ((?price1 - ?price2) / ?price2 * 100 AS ?percentDiff)
WHERE {
  # First SME agreement
  ?agreement1 a dataact:B2BDataSharing ;
              dataact:governedBy ?contract1 ;
              dpv:hasRecipient ?recipient1 .
  ?contract1 dataact:compensationAmount ?price1 .
  ?recipient1 a dataact:SME .
  
  # Second SME agreement (comparable)
  ?agreement2 a dataact:B2BDataSharing ;
              dataact:governedBy ?contract2 ;
              dpv:hasRecipient ?recipient2 .
  ?contract2 dataact:compensationAmount ?price2 .
  ?recipient2 a dataact:SME .
  
  # Different agreements
  FILTER(?agreement1 != ?agreement2)
  
  # Significant difference (>15%)
  FILTER(?price1 > ?price2 * 1.15)
}
ORDER BY DESC(?percentDiff)